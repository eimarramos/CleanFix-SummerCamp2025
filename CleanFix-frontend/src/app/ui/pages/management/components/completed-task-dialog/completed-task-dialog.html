<dialog
  #dialog
  tabindex="0"
  class="fixed inset-0 z-50 m-0 h-screen max-h-none w-screen max-w-none bg-transparent p-0 sm:flex sm:items-center sm:justify-center"
  (close)="onClose()"
  (click)="onBackdropClick($event)"
  (keydown.escape)="onClose()"
>
  <div
    #dialogContent
    class="dialog-content flex h-full w-full flex-col bg-brand-0 sm:h-auto sm:max-h-[85vh] sm:w-auto sm:max-w-3xl sm:min-w-[600px] sm:rounded-xl sm:shadow-2xl"
  >
    <header
      class="flex shrink-0 items-center justify-between bg-primary-500 px-4 py-3 text-brand-0 sm:px-6 sm:py-4"
    >
      <h1 class="text-lg font-semibold sm:text-xl">Detalles de Tarea Completada</h1>
      <form method="dialog" id="completed-task-dialog-form">
        <button
          class="rounded-full p-1 transition-colors hover:bg-brand-600"
          aria-label="Cerrar dialog"
        >
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </form>
    </header>

    <div class="scrollbar-hide flex-1 overflow-y-auto p-4 sm:p-6">
      @if (isLoading()) {
        <div class="flex items-center justify-center py-8">
          <div
            class="h-8 w-8 animate-spin rounded-full border-4 border-primary-500 border-t-transparent"
          ></div>
          <span class="ml-2 text-brand-600">Cargando detalles...</span>
        </div>
      } @else if (completedTask()) {
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 sm:gap-6">
          <!-- Información básica -->
          <div class="col-span-1 sm:col-span-2">
            <h2 class="mb-4 text-lg font-semibold text-brand-800">Información General</h2>
            <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 sm:gap-4">
              <div class="flex flex-col">
                <span class="text-sm font-medium text-brand-600">ID</span>
                <p class="text-base text-brand-800 sm:text-lg">{{ completedTask()!.id }}</p>
              </div>
              <div class="flex flex-col">
                <span class="text-sm font-medium text-brand-600">Tipo de Trabajo</span>
                <p class="text-base font-semibold text-brand-800 sm:text-lg">
                  {{ completedTask()!.isSolicitation ? 'Solicitud' : 'Incidencia' }}
                </p>
              </div>
              <div class="col-span-1 flex flex-col sm:col-span-2">
                <span class="text-sm font-medium text-brand-600">Dirección</span>
                <p class="text-base text-brand-800 sm:text-lg">{{ completedTask()!.address }}</p>
              </div>
              <div class="flex flex-col">
                <span class="text-sm font-medium text-brand-600">Tipo de Problema</span>
                <p class="text-base text-brand-800 sm:text-lg">{{ completedTask()!.issueType }}</p>
              </div>
              <div class="flex flex-col">
                <span class="text-sm font-medium text-brand-600">Superficie (m²)</span>
                <p class="text-base text-brand-800 sm:text-lg">{{ completedTask()!.surface }}</p>
              </div>
            </div>
          </div>

          <!-- Fechas -->
          <div class="col-span-1 sm:col-span-2">
            <h2 class="mb-4 text-lg font-semibold text-brand-800">Fechas</h2>
            <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 sm:gap-4">
              <div class="flex flex-col">
                <span class="text-sm font-medium text-brand-600">Fecha de Creación</span>
                <p class="text-base text-brand-800 sm:text-lg">
                  {{ completedTask()!.creationDate | date: 'dd/MM/yyyy HH:mm' }}
                </p>
              </div>
              <div class="flex flex-col">
                <span class="text-sm font-medium text-brand-600">Fecha de Finalización</span>
                <p class="text-base text-brand-800 sm:text-lg">
                  {{ completedTask()!.completionDate | date: 'dd/MM/yyyy HH:mm' }}
                </p>
              </div>
            </div>
          </div>

          <!-- Información de la empresa -->
          <div class="col-span-1 sm:col-span-2">
            <h2 class="mb-4 text-lg font-semibold text-brand-800">Empresa Asignada</h2>
            <div class="rounded-lg border border-brand-200 bg-brand-50 p-4">
              <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 sm:gap-4">
                <div class="flex items-center gap-2">
                  <span class="font-semibold text-brand-700">Nombre:</span>
                  <span class="text-brand-900">{{ completedTask()!.company.name }}</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="font-semibold text-brand-700">Teléfono:</span>
                  <span class="text-brand-900">{{ completedTask()!.company.number }}</span>
                </div>
                <div class="col-span-1 flex items-center gap-2 sm:col-span-2">
                  <span class="font-semibold text-brand-700">Dirección:</span>
                  <span class="text-brand-900">{{ completedTask()!.company.address }}</span>
                </div>
                <div class="col-span-1 flex items-center gap-2 sm:col-span-2">
                  <span class="font-semibold text-brand-700">Email:</span>
                  <span class="text-brand-900">{{ completedTask()!.company.email }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Precio -->
          <div class="col-span-1 sm:col-span-2">
            <h2 class="mb-4 text-lg font-semibold text-brand-800">Información Financiera</h2>
            <div class="rounded-lg bg-brand-100 px-4 py-3 text-center">
              <span class="text-sm font-medium text-brand-600">Precio Total</span>
              <p class="text-success-600 text-2xl font-bold">
                {{ completedTask()!.price | currency: 'EUR' : 'symbol' : '1.2-2' }}
              </p>
            </div>
          </div>

          <!-- Materiales -->
          @if (completedTask()!.materials && completedTask()!.materials.length > 0) {
            <div class="col-span-1 sm:col-span-2">
              <h2 class="mb-4 text-lg font-semibold text-brand-800">Materiales Utilizados</h2>
              <div class="space-y-2">
                @for (material of completedTask()!.materials; track material) {
                  <div class="rounded border border-brand-200 bg-brand-50 px-3 py-2">
                    <div class="font-semibold text-brand-800">{{ material }}</div>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="py-8 text-center">
          <p class="text-red-600">Error al cargar los detalles de la tarea.</p>
        </div>
      }
    </div>

    <footer
      class="flex shrink-0 justify-end gap-3 border-t border-brand-200 bg-brand-50 px-4 py-3 sm:px-6 sm:py-4"
    >
      <button
        class="rounded-lg bg-brand-500 px-4 py-2 text-sm font-medium text-brand-0 transition-colors hover:bg-brand-600 sm:text-base"
        (click)="onClose()"
      >
        Cerrar
      </button>
    </footer>
  </div>
</dialog>
